<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Gemini API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ü§ñ Test Gemini API</h1>
    
    <div class="container">
        <h3>1. Ki·ªÉm tra API Key</h3>
        <p>API Key: <span id="apiKeyStatus">ƒêang ki·ªÉm tra...</span></p>
        <button onclick="checkApiKey()">Ki·ªÉm tra API Key</button>
        
        <h3>2. Test API v·ªõi c√¢u h·ªèi ƒë∆°n gi·∫£n</h3>
        <input type="text" id="testQuestion" placeholder="Nh·∫≠p c√¢u h·ªèi test..." value="Tri·∫øt h·ªçc M√°c-L√™nin l√† g√¨?">
        <button onclick="testSimpleAPI()">Test API ƒë∆°n gi·∫£n</button>
        
        <h3>3. Test API v·ªõi c√°c models kh√°c nhau</h3>
        <button onclick="testDifferentModels()">Test c√°c models</button>
        
        <div id="results"></div>
    </div>

    <script>
    // L∆∞u √Ω: Trang n√†y d·ª±a v√†o Vite dev proxy (/api/gemini/*). H√£y ch·∫°y `npm run dev`.
    // Kh√¥ng c·∫ßn ch√®n API key ·ªü client n·ªØa.
    const API_KEY = null;
        
        function addResult(content, type = 'result') {
            const resultsDiv = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = content;
            resultsDiv.appendChild(div);
        }

        function checkApiKey() {
            const apiKeyElement = document.getElementById('apiKeyStatus');
            apiKeyElement.innerHTML = '<span style="color: green;">‚úÖ S·ª≠ d·ª•ng proxy dev (kh√¥ng c·∫ßn API Key ·ªü client)</span>';
            addResult('‚úÖ S·ª≠ d·ª•ng proxy dev: /api/gemini/<model>', 'success');
            return true;
        }

        async function testSimpleAPI() {
            if (!checkApiKey()) return;
            
            const question = document.getElementById('testQuestion').value;
            addResult('üîÑ ƒêang test API v·ªõi c√¢u h·ªèi: "' + question + '"...');
            
            const models = [
                'gemini-2.5-flash',
                'gemini-1.5-flash-latest',
                'gemini-1.5-flash',
                'gemini-1.5-pro',
                'gemini-pro'
            ];

            for (const model of models) {
                try {
                    const url = `/api/gemini/${model}`;
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: question
                                }]
                            }]
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const answer = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Kh√¥ng c√≥ ph·∫£n h·ªìi';
                        addResult(`‚úÖ <strong>${model}</strong>: HO·∫†T ƒê·ªòNG<br><em>Ph·∫£n h·ªìi:</em> ${answer.substring(0, 200)}...`, 'success');
                        return; // D·ª´ng ·ªü model ƒë·∫ßu ti√™n ho·∫°t ƒë·ªông
                    } else {
                        const errorText = await response.text();
                        addResult(`‚ùå <strong>${model}</strong>: KH√îNG HO·∫†T ƒê·ªòNG<br>L·ªói: ${response.status} - ${errorText}`, 'error');
                    }
                } catch (error) {
                    addResult(`‚ùå <strong>${model}</strong>: L·ªñI K·∫æT N·ªêI<br>Chi ti·∫øt: ${error.message}`, 'error');
                }
            }
        }

        async function testDifferentModels() {
            if (!checkApiKey()) return;
            
            addResult('üîÑ ƒêang test t·∫•t c·∫£ c√°c models c√≥ s·∫µn...');
            
            const models = [
                'gemini-2.5-flash',
                'gemini-1.5-flash-latest',
                'gemini-1.5-flash',
                'gemini-1.5-flash-8b',
                'gemini-1.5-pro',
                'gemini-1.5-pro-latest',
                'gemini-pro'
            ];

            for (const model of models) {
                try {
                    const url = `/api/gemini/${model}`;
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: "Ch√†o b·∫°n, h√£y tr·∫£ l·ªùi ng·∫Øn g·ªçn: Tri·∫øt h·ªçc l√† g√¨?"
                                }]
                            }]
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        addResult(`‚úÖ <strong>${model}</strong>: HO·∫†T ƒê·ªòNG B√åNH TH∆Ø·ªúNG`, 'success');
                    } else {
                        const errorText = await response.text();
                        addResult(`‚ùå <strong>${model}</strong>: ${response.status} - ${errorText.substring(0, 100)}`, 'error');
                    }
                } catch (error) {
                    addResult(`‚ö†Ô∏è <strong>${model}</strong>: L·ªói k·∫øt n·ªëi - ${error.message}`, 'error');
                }
                
                // Delay ƒë·ªÉ tr√°nh rate limit
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        // Ch·∫°y ki·ªÉm tra t·ª± ƒë·ªông khi load trang
        window.onload = function() {
            checkApiKey();
            // T·ª± ƒë·ªông ch·∫°y test ƒë∆°n gi·∫£n sau khi trang s·∫µn s√†ng
            setTimeout(() => {
                testSimpleAPI();
            }, 200);
        }
    </script>
</body>
</html>